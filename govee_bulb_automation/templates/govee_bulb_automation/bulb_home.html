<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Light Control</title>
    {% load static %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{% static 'css/styles.css' %}" rel="stylesheet">
</head>
<body class="bg-light">

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<div class="container py-5">
    <!-- Heading -->
    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold">Light Control</h1>
        <p class="text-muted">Control your lights, color, and temperature.</p>
    </div>

    <!-- Light Toggle Buttons -->
    <div class="row justify-content-center mb-4">
        <div class="col-auto">
            <button type="button" class="btn btn-success btn-lg px-5" onclick="toggleLight('on')">Turn On</button>
        </div>
        <div class="col-auto">
            <button type="button" class="btn btn-danger btn-lg px-5" onclick="toggleLight('off')">Turn Off</button>
        </div>
    </div>

<!-- Temperature Grid -->
<div class="card shadow-sm p-4 mb-5">
    <h5 class="mb-3">Select Temperature</h5>
    <div class="d-flex flex-wrap gap-2 justify-content-center">
        <button class="btn temp-btn" style="background-color: #FFB74D;" onclick="setTemperature(2700)">2700K</button>
        <button class="btn temp-btn" style="background-color: #FFD54F;" onclick="setTemperature(3000)">3000K</button>
        <button class="btn temp-btn" style="background-color: #FFF176;" onclick="setTemperature(3500)">3500K</button>
        <button class="btn temp-btn" style="background-color: #ffff89;" onclick="setTemperature(4000)">4000K</button>
        <button class="btn temp-btn" style="background-color: #ffffa6;" onclick="setTemperature(5000)">5000K</button>
        <button class="btn temp-btn" style="background-color: #ffffc8;" onclick="setTemperature(6000)">6000K</button>
        <button class="btn temp-btn" style="background-color: #ffffff;" onclick="setTemperature(6500)">6500K</button>
    </div>
</div>

    <!-- Color Picker -->
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
    <div class="card shadow-sm p-4 text-center">
        <h5 class="mb-3">Choose Color</h5>
        <div class="d-flex justify-content-center">
            <div id="colorWheel"></div>
        </div>
    </div>
</div>

</body>

<!-- Toggle light -->
<script>
    function toggleLight(state) {
        fetch('/toggle_light/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ state: state })
        })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    alert(`Failed to turn ${state}\n${JSON.stringify(data.response, null, 2)}`);
                }
            });
    }
</script>


<!-- Temperature selector -->
<script>
    function setTemperature(kelvin) {
        fetch('/set_temperature/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                // 'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ temperature: kelvin })
        })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    alert(`${JSON.stringify(data.response, null, 2)}`);
                }
            })
    }
</script>

<!-- Color chooser-->
<script>
    const colorPicker = new iro.ColorPicker("#colorWheel", {
        width: 250,
        color: "#ff9900",
        layout: [
            { component: iro.ui.Wheel },
            { component: iro.ui.Slider, options: { sliderType: 'value' } },
        ]
    });

    colorPicker.on('color:change', function(color) {
        const rgb = color.rgb;
        fetch('/set_color/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ color: `#${color.hexString.slice(1)}` })
        });
    });
</script>

</html>